{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4 text-center">Topsis</h1>
    <div class="form-step">
        <ul>
            <li class="step-focus">Step 1</li>
            <li >Step 2</li>
            <li >Step 3</li>
        </ul>
    </div>
    <h2>Define Criteria Weights for TOPSIS</h2>
    <form method="POST">
        {% for criteria in criterias %}
        <div class="row align-items-center mb-3">
            <div class="col-md-4 distinct-label">
                <label for="{{ criteria }}" class="form-label">{{ criteria.replace('_', ' ').capitalize() }}</label>
            </div>
            <div class="col-md-4">
                <input type="number" step="any" 
                name="{{ criteria }}" id="{{ criteria }}" class="form-control weight-input"
                    value="{{ weights.get(criteria, '') }}" required>
            </div>
            <div class="col-md-4">
                <label id="{{ criteria }}-percent" class="form-label">0.00%</label>
            </div>
        </div>
        {% endfor %}
        <div class="row align-items-center mb-3">
            <div class="col-md-4 distinct-label"></div>
            <div class="col-md-4">
                <p class="total-weight">Total Weight: <span id="current-total">0.00</span></p>
            </div>
        </div>
        <div class="row align-items-center mb-3">
            <div class="col-md-4">
                <button type="submit" class="btn btn-primary">Normalize and Next Step</button>
            </div>
        </div>
    </form>
</div>

<script>
    // Function to update total weight and percentages dynamically
    function updateWeights() {
        const weightInputs = document.querySelectorAll('.weight-input');
        let totalWeight = 0;

        // Calculate total weight
        weightInputs.forEach(input => {
            totalWeight += parseFloat(input.value) || 0;
        });

        // Update total weight display
        document.getElementById('current-total').textContent = totalWeight.toFixed(2);

        // Update percentages for each criterion
        weightInputs.forEach(input => {
            const value = parseFloat(input.value) || 0;
            const percent = totalWeight > 0 ? (value / totalWeight) * 100 : 0;
            document.getElementById(`${input.id}-percent`).textContent = `${percent.toFixed(2)}%`;
        });
    }

    // Initialize weights and attach event listeners
    document.addEventListener('DOMContentLoaded', () => {
        updateWeights();
        document.querySelectorAll('.weight-input').forEach(input => {
            input.addEventListener('input', updateWeights);
        });
    });
</script>
{% endblock %}
